{% extends "layout.html" %}

{% block title %}Candidates - AI Recruitment System{% endblock %}

{% block page_title %}Candidates{% endblock %}
{% block page_subtitle %}Manage and view all candidate profiles{% endblock %}

{% block page_actions %}
    <div class="btn-group" role="group">
        <a href="{{ url_for('add_candidate') }}" class="btn btn-primary btn-ripple">
            <i class="bi bi-plus-circle me-1"></i> Add Candidate
        </a>
        <a href="{{ url_for('upload_candidates') }}" class="btn btn-outline-primary btn-ripple">
            <i class="bi bi-upload me-1"></i> Upload CVs
        </a>
    </div>
{% endblock %}

{% block content %}
    <div class="card animate-fade-in">
        <div class="card-header d-flex justify-content-between align-items-center">
            <h5 class="card-title mb-0">All Candidates</h5>
            <div class="input-group w-auto" style="max-width: 300px;">
                <span class="input-group-text bg-transparent border-end-0">
                    <i class="bi bi-search"></i>
                </span>
                <input type="text" class="form-control border-start-0" id="candidateSearch" placeholder="Search candidates...">
            </div>
        </div>
        <div class="card-body p-0">
            {% if candidates %}
                <div class="row p-4 g-4 candidates-grid stagger-fade-in">
                    {% for candidate in candidates %}
                        <div class="col-xl-4 col-md-6">
                            <div class="card candidate-card card-3d-effect h-100">
                                <div class="card-body p-3">
                                    <div class="d-flex align-items-center mb-3">
                                        <div class="rounded-circle bg-primary bg-opacity-10 p-3 me-3 candidate-icon">
                                            <i class="bi bi-person text-primary"></i>
                                        </div>
                                        <div>
                                            <h5 class="card-title mb-1 fw-bold">{{ candidate.name }}</h5>
                                            <p class="text-muted mb-0 small">{{ candidate.email }}</p>
                                        </div>
                                    </div>
                                    
                                    {% if candidate.skills_dict %}
                                        <div class="skills-container mb-3">
                                            <h6 class="text-secondary small mb-2">Top Skills</h6>
                                            <div class="d-flex flex-wrap gap-1">
                                                {% for skill, level in candidate.skills_dict.items() %}
                                                    {% if loop.index <= 4 %}
                                                        <span class="badge text-bg-secondary rounded-pill hover-glow">{{ skill }}</span>
                                                    {% endif %}
                                                {% endfor %}
                                                {% if candidate.skills_dict|length > 4 %}
                                                    <span class="badge text-bg-secondary rounded-pill">+{{ candidate.skills_dict|length - 4 }}</span>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="experience-container mb-3">
                                        <h6 class="text-secondary small mb-2">Experience</h6>
                                        <div class="d-flex align-items-center">
                                            <i class="bi bi-briefcase text-primary me-2"></i>
                                            <span>{{ candidate.experience_list|length if candidate.experience_list else 0 }} positions</span>
                                        </div>
                                    </div>
                                    
                                    {% if candidate.jobs %}
                                        <div class="match-container mb-4">
                                            <h6 class="text-secondary small mb-2">Best Match</h6>
                                            {% set best_match = candidate.jobs|sort(attribute='overall_score', reverse=True)|first %}
                                            {% set score_color = 'success' if best_match.overall_score >= 80 else ('primary' if best_match.overall_score >= 60 else ('warning' if best_match.overall_score >= 40 else 'danger')) %}
                                            <div class="d-flex align-items-center">
                                                <div class="match-indicator me-2 d-inline-flex align-items-center justify-content-center rounded-circle bg-{{ score_color }}" style="width: 36px; height: 36px;">{{ best_match.overall_score }}%</div>
                                                <span class="text-truncate">{{ best_match.job.job_title }}</span>
                                            </div>
                                        </div>
                                    {% endif %}
                                    
                                    <div class="card-actions mt-auto d-flex justify-content-between">
                                        <span class="text-secondary small">Added {{ candidate.created_at.strftime('%b %d, %Y') }}</span>
                                        <div>
                                            <a href="{{ url_for('view_candidate', candidate_id=candidate.candidate_id) }}" class="btn btn-sm btn-primary btn-ripple">
                                                <i class="bi bi-eye me-1"></i> Profile
                                            </a>
                                            <a href="{{ url_for('view_candidate_insights', candidate_id=candidate.candidate_id) }}" class="btn btn-sm btn-info btn-ripple">
                                                <i class="bi bi-lightbulb me-1"></i> Insights
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                    {% endfor %}
                </div>
            {% else %}
                <div class="text-center py-5">
                    <div class="rounded-circle bg-secondary bg-opacity-10 d-inline-flex align-items-center justify-content-center mb-3" style="width: 80px; height: 80px;">
                        <i class="bi bi-people fs-1 text-secondary"></i>
                    </div>
                    <h5>No candidates found</h5>
                    <p class="text-muted">Get started by adding your first candidate or uploading CVs.</p>
                    <div class="mt-3">
                        <a href="{{ url_for('add_candidate') }}" class="btn btn-primary btn-ripple">
                            <i class="bi bi-plus-circle me-1"></i> Add a Candidate
                        </a>
                        <a href="{{ url_for('upload_candidates') }}" class="btn btn-outline-primary btn-ripple ms-2">
                            <i class="bi bi-upload me-1"></i> Upload CVs
                        </a>
                    </div>
                </div>
            {% endif %}
        </div>
    </div>
{% endblock %}

{% block scripts %}
<script>
    document.addEventListener('DOMContentLoaded', function() {
        // Simple client-side search functionality
        const searchInput = document.getElementById('candidateSearch');
        if (searchInput) {
            searchInput.addEventListener('keyup', function() {
                const searchValue = this.value.toLowerCase();
                const candidateCards = document.querySelectorAll('.candidate-card');
                
                candidateCards.forEach(card => {
                    const cardText = card.textContent.toLowerCase();
                    if (cardText.includes(searchValue)) {
                        card.closest('.col-xl-4').style.display = '';
                    } else {
                        card.closest('.col-xl-4').style.display = 'none';
                    }
                });
            });
        }
        
        // Initialize hover effect for candidate cards
        const candidateCards = document.querySelectorAll('.candidate-card');
        candidateCards.forEach(card => {
            // Add hover transition effect
            card.addEventListener('mouseenter', function() {
                this.style.transform = 'translateY(-8px)';
                this.style.boxShadow = '0 10px 20px rgba(0, 0, 0, 0.3)';
                
                // Animate icon
                const icon = this.querySelector('.candidate-icon');
                if (icon) {
                    icon.style.transform = 'scale(1.1)';
                }
                
                // Highlight skills
                const skills = this.querySelectorAll('.badge');
                skills.forEach((skill, index) => {
                    setTimeout(() => {
                        skill.style.transform = 'scale(1.05)';
                    }, index * 50);
                });
                
                // Pop action buttons
                const buttons = this.querySelectorAll('.btn');
                buttons.forEach((btn, index) => {
                    setTimeout(() => {
                        btn.classList.add('btn-pop');
                    }, index * 100);
                });
            });
            
            card.addEventListener('mouseleave', function() {
                this.style.transform = '';
                this.style.boxShadow = '';
                
                // Reset icon
                const icon = this.querySelector('.candidate-icon');
                if (icon) {
                    icon.style.transform = '';
                }
                
                // Reset skills
                const skills = this.querySelectorAll('.badge');
                skills.forEach(skill => {
                    skill.style.transform = '';
                });
                
                // Reset buttons
                const buttons = this.querySelectorAll('.btn');
                buttons.forEach(btn => {
                    btn.classList.remove('btn-pop');
                });
            });
        });
    });
</script>
{% endblock %}
